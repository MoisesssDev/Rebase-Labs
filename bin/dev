#!/bin/bash

docker network create rebase-labs

docker compose run \
  --rm \
  -d \
  --name redis \
  redis

docker compose run \
  --rm \
  -d \
  --name redis-worker \
  app \
  bash -c "bundle install && sidekiq -r ./jobs/import_csv_job.rb"

docker compose run \
  --rm \
  -d \
  --name pgserver \
  pgserver

docker compose run \
  --rm \
  --name rebase-labs \
  --service-ports \
  app \
  bash -c "bundle install && ruby server.rb"

docker compose run --rm app ruby lib/clean_up.rb


docker stop pgserver
docker stop redis-worker
docker stop redis