#!/bin/bash

docker network rm rebase-network

docker network create rebase-network

docker run -d --rm --name rebase-redis --network rebase-network redis

docker run \
    -d \
    --rm \
    --name rebase-postgres \
    --network rebase-network \
    -e POSTGRES_DB=rebase-db \
    -e POSTGRES_USER=rebase \
    -e POSTGRES_PASSWORD=rebase \
    postgres

docker run \
  --rm \
  --name rebase-challenge \
  --network rebase-network \
  -w /app \
  -v .:/app \
  -p 3000:3000 \
  -e REDIS_URL=redis://rebase-redis:6379/0 \
  ruby:3.2.2 \
  bash -c "bundle install && sidekiq -r ./jobs/import_csv_job.rb && ruby server.rb"

docker stop rebase-redis
docker stop rebase-postgres
